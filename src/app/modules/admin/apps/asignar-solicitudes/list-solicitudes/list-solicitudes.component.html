<div class="py-2 px-3 h-screen w-100 bg-white rounded-lg overflow-x-auto">
    <div class="grid grid-cols-12 w-100">
        <h2 class="text-gray-900 col-span-12 mb-4">Asignación de solicitudes de crédito.</h2>
    </div>
    <div class="flex flex-col w-full">
        <div class="flex flex-col w-full">
            <form [formGroup]="buscarForm">
                <div class="flex flex-row gap-4">
                    <div class="w-56">
                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Analista</mat-label>
                            <mat-select formControlName="analista">
                                <mat-option *ngFor="let item of asesores" [value]="item.idusuario">{{ item.idusuario }}</mat-option>
                            </mat-select>
                            <mat-error *ngIf="buscarForm.get('analista').hasError('required')">
                                Se debe seleccionar un analista.
                            </mat-error>
                          </mat-form-field>
                    </div>
                    <div class="w-56">
                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Periodo</mat-label>
                            <mat-date-range-input [rangePicker]="picker">
                                <input matStartDate formControlName="fechaInicial" placeholder="Fecha inicial">
                                <input matEndDate [max]="maxFecha" formControlName="fechaFinal" placeholder="Fecha final">
                            </mat-date-range-input>
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-date-range-picker #picker></mat-date-range-picker>
                            <mat-error *ngIf="buscarForm.get('fechaInicial').hasError('required')">
                                Se debe ingresar una fecha inicial.
                            </mat-error>
                            <mat-error *ngIf="buscarForm.get('fechaFinal').hasError('required')">
                                Se debe ingresar una fecha final.
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div class="w-56">
                        <mat-form-field appearance="fill" class="w-full ">
                            <mat-label>Unidad de negocio</mat-label>
                            <mat-select formControlName="unidad">
                              <mat-option value="22">Libranza</mat-option>
                              <mat-option value="Capacidad de pago">Capacidad de pago</mat-option>
                            </mat-select>
                            <mat-error *ngIf="buscarForm.get('unidad').hasError('required')">
                                Se debe elegir una unidad de negocio.
                            </mat-error>
                        </mat-form-field>
                    </div>
                    <div class="mt-4">
                        <button mat-raised-button class="text-white w-30 permitir bloquear" [disabled]="buscarForm.invalid" (click)="buscar()">
                            <div class="flex flex-row w-full justify-between gap-2">
                                <div>
                                    <mat-icon svgIcon="heroicons_outline:search"></mat-icon>
                                </div>
                                <div class="mt-1.5">
                                    <span>Buscar</span>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
            </form>
            <div class="flex flex-col">
                <div class="flex flex-col w-full justify-between">
                    <div class="flex flex-row w-full gap-4 mt-2">
                        <div class="flex flex-row h-28 w-96 p-2 bg-card shadow rounded-2xl overflow-hidden" *ngFor="let item of asignados">
                            <div class="flex flex-col w-1/5 pl-2">
                                <div class="w-20 h-20">
                                    <img src="assets/images/agendas/{{item.icono}}" class="text-current">
                                </div>
                            </div>
                            <div class="flex flex-col w-11/12">
                                <div class="text-lg font-medium truncate pl-2 mt-1 mb-3 w-full text-center">{{item.nombreAgenda}}</div>
                                <div class="flex flex-row justify-center gap-3">
                                    <div class="flex flex-row gap-1">
                                        <div class="bg-green-200 flex flex-row h-10 w-10 items-center justify-center rounded-3xl">
                                            <mat-icon class="ml-1 cursor-pointer" svgIcon="heroicons_outline:user-add" matTooltip="Asignadas"></mat-icon>
                                        </div>
                                        <div class="mt-0.5 text-6xl sm:text-4xl font-bold tracking-tight leading-none">
                                            {{item.asignados}}
                                        </div>
                                    </div>
                                    <div class="flex flex-row gap-1">
                                        <div class="bg-blue-200 flex flex-row h-10 w-10 items-center justify-center rounded-3xl">
                                            <mat-icon class="cursor-pointer" svgIcon="heroicons_outline:refresh" matTooltip="Reasignadas"></mat-icon>
                                        </div>
                                        <div class="mt-0.5 text-6xl sm:text-4xl font-bold tracking-tight leading-none">
                                            {{item.re_asignados}}
                                        </div>
                                    </div>
                                    <div class="flex flex-row gap-1">
                                        <div class="bg-red-200 flex flex-row h-10 w-10 items-center justify-center rounded-3xl">
                                            <mat-icon class="cursor-pointer" svgIcon="heroicons_outline:dots-circle-horizontal" matTooltip="Sin asignar"></mat-icon>
                                        </div>
                                        <div class="mt-0.5 text-6xl sm:text-4xl font-bold tracking-tight leading-none">
                                            {{item.sin_asignar}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-4 flex flex-row w-full justify-between">
            <div class="flex flex-row w-1/4 gap-2">
                <button mat-raised-button class="text-white w-30 permitir bloquear" [disabled]="soliAsignar.length<1" (click)="asignarVarias()">
                    <div class="flex flex-row w-full justify-between gap-2">
                        <div>
                            <mat-icon svgIcon="heroicons_outline:user-add"></mat-icon>
                        </div>
                        <div class="mt-1.5">
                            <span>Asignar</span>
                        </div>
                    </div>
                </button>
                <button mat-raised-button class="text-white w-30 permitir bloquear" [disabled]="soliReasignar.length<1" (click)="reasignarVarias()">
                    <div class="flex flex-row w-full justify-between gap-2">
                        <div>
                            <mat-icon svgIcon="heroicons_outline:refresh"></mat-icon>
                        </div>
                        <div class="mt-1.5">
                            <span>Reasignar</span>
                        </div>
                    </div>
                </button>
            </div>
            <div class="flex flex-row w-3/4 justify-end">
                <input class="border rounded p-2 bg-gray-100 w-52" style="font-size: 10px; margin-right: 1em;"
                        type="text" autocomplete="off" name="filtrarTabla" [(ngModel)]="filtrarTabla"
                        placeholder="Filtrar...">
            </div>
        </div>
        <div class="w-full max-height overflow-y-auto mt-2">
            <table class="p-0">
                <tbody class="bg-white">
                    <ng-container *ngFor="let item of solicitudes | filter:filtrarTabla">
                        <tr class="text-gray-700 border-t border-b">
                            <td rowspan="2" class="py-3 text-sm my-10">
                                <div class="ml-2.5">
                                    <mat-checkbox [(ngModel)]="item.chequeado" (ngModelChange)="updateAllComplete()" (change)="agregarSoli(item, $event)"></mat-checkbox>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-1" rowspan="2">
                                <div class="flex flex-column " rowspan="2">
                                    <div class="flex-0 w-12 overflow-hidden">
                                        <img [src]="item.urlIconoUnidad" matTooltip="{{item.undadNegocio}}" class="w-full h-full object-cover cursor-pointer">
                                    </div>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-2" rowspan="2">
                                <div class="flex flex-column " rowspan="2">
                                    <small class="text-accent-600 text-xs">Solicitud:</small>
                                    <span class="text-md text-black font-medium">{{item.numeroSolicitud}}</span>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-4">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Valor del crédito:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="attach_money"></mat-icon>
                                        {{item.monto | number}}
                                    </span>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-4">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Etapa:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="heroicons_outline:book-open"></mat-icon>
                                        {{item.subEstado}}
                                    </span>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-4">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Analista asignado:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="heroicons_outline:user"></mat-icon>
                                        {{item.asesor}}
                                    </span>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-4">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Fecha de asignación:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="heroicons_outline:calendar">
                                        </mat-icon>
                                        {{ cambiarFecha(item.fecha_asigacion) }}
                                    </span>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-4">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Analista reasignado:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="heroicons_outline:user"></mat-icon>
                                        {{item.asesor_antiguo}}
                                    </span>
                                </div>
                            </td>
                            <td class="px-2 pb-0 pt-4">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Fecha de últ reasignación:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="heroicons_outline:calendar">
                                        </mat-icon>
                                        {{ cambiarFecha(item.fecha_re_asigado) }}
                                    </span>
                                </div>
                            </td>
                            <td rowspan="2" class="py-3 text-sm my-3">
                                <div class="flex flex-row justify-center gap-2">
                                    <button mat-raised-button class="per-asig blo-asig" matTooltip="Asignar un analista" [disabled]="item.asesor!=''" (click)="asignarUna(item.numeroSolicitud)">
                                        <mat-icon svgIcon="heroicons_outline:user-add"></mat-icon>
                                    </button>
                                    <button mat-raised-button class="per-reasig blo-reasig" matTooltip="Reasignar un analista" [disabled]="item.asesor==''" (click)="reasignarUna(item)">
                                        <mat-icon svgIcon="heroicons_outline:refresh"></mat-icon>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr class="text-gray-700 border-t border-b">
                            <td class="px-2 pb-4 pt-1">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Identificación:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="heroicons_outline:identification"></mat-icon>
                                        {{item.identificacion}}
                                    </span>
                                </div>
                            </td>
                            <td class="px-2 pb-4 pt-1">
                                <div class="flex flex-column">
                                    <small class="text-accent-600 text-xs">Nombre del cliente:</small>
                                    <span class="text-md text-black font-medium">
                                        <mat-icon class="icon-size-3" svgIcon="heroicons_outline:user-circle"></mat-icon> 
                                        {{item.nombreCompleto}}
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </ng-container>
                </tbody>
            </table>
        </div>
    </div>
</div>
