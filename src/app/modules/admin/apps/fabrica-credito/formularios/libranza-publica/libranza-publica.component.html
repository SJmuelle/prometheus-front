<div class="bg-white h-screen sm:pb-40 md:pb-11 pb-40 overflow-auto px-3 rounded-lg shadow w-full y-100" cdkScrollable>
    <div class="flex flex-wrap w-full mx-auto p-6 md:p-8 bg-white z-10">

        <!-- Title and action buttons -->
        <div class="flex items-center justify-between w-full sm:flex-row flex-col">
            <div class="flex items-center ">
                <div class="flex-0 w-16 h-16  overflow-hidden">
                    <img src="assets/images/agendas/formulario-de-llenado.png" class="w-full h-full object-cover">
                </div>
                <div class="flex-1 mx-3">
                    <div class="text-3xl font-bold tracking-tight leading-8 text-gray-700">Formulario de libranza
                        publica
                    </div>
                    <div class="flex items-center">
                        <mat-icon svgIcon="heroicons_solid:bell" class="text-gray-400"></mat-icon>
                        <div class="font-medium tracking-tight text-secondary">
                            Complete el formulario
                        </div>
                    </div>


                </div>

            </div>
        </div>
    </div>
    <mat-stepper [linear]="false" [orientation]="orientationStep " #stepper class="md:px-8 sm:px-0"
        (selectionChange)="onStepChange($event)">
        <mat-step [stepControl]="datosBasicos">
            <form [formGroup]="datosBasicos">
                <ng-template matStepLabel>Datos basicos</ng-template>
                <div class="bg-white  rounded mt-4 pb-4 grid grid-cols-1  md:grid-cols-2">
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Tipo de documento</mat-label>
                        <mat-select formControlName="tipoDocumento" (selectionChange)="preCargueDeDatos()">
                            <mat-option *ngFor="let tipoDocumento of dataInicial?.tipoDocumento"
                                [value]="tipoDocumento?.codigo" [disabled]="tipoDocumento.codigo === 'CE'">
                                {{tipoDocumento?.nombre}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="datosBasicos.controls.tipoDocumento.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>No. de documento</mat-label>
                        <input matInput (change)="preCargueDeDatos()" type="text" [mask]="'separator.0'" [thousandSeparator]="'.'" autocomplete="off"
                            formControlName="documento">
                        <mat-error *ngIf="datosBasicos.controls.documento.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                        <mat-error *ngIf="datosBasicos.controls.documento.errors?.pattern">
                            Cantidad de números de 5-10.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Celular</mat-label>
                        <input matInput type="text" autocomplete="off" formControlName="celular" prefix="+57 "
                            mask="(000) 000 00 00">
                        <mat-error *ngIf="datosBasicos.controls.celular.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                        <mat-error *ngIf="datosBasicos.controls.celular.errors?.pattern">
                            Debe comenzar en 3 y tener 10 digitos
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Correo electrónico</mat-label>
                        <input formControlName="email" type="email" matInput autocomplete="off" />
                        <mat-error *ngIf="datosBasicos.controls.email.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                        <mat-error *ngIf="datosBasicos.controls.email.errors?.email">
                            Email invalido
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Primer nombre</mat-label>
                        <input matInput type="text" autocomplete="off" formControlName="primerNombre">
                        <mat-error *ngIf="datosBasicos.controls.primerNombre.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                        <mat-error *ngIf="datosBasicos.controls.primerNombre.errors?.pattern">
                            No se aceptan caracteres especiales.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Primer apellido</mat-label>
                        <input matInput type="text" autocomplete="off" formControlName="primerApellido">
                        <mat-error *ngIf="datosBasicos.controls.primerNombre.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                        <mat-error *ngIf="datosBasicos.controls.primerNombre.errors?.pattern">
                            No se aceptan caracteres especiales.
                        </mat-error>
                    </mat-form-field>



                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Genero</mat-label>
                        <mat-select formControlName="genero">
                            <mat-option *ngFor="let genero of dataInicial?.generos" [value]="genero.codigo">
                                {{genero.nombre}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="datosBasicos.controls.genero.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense ">
                        <mat-label>¿Cúando naciste?</mat-label>
                        <input style="max-height: 18px !important;" matInput type="date" autocomplete="off"
                            formControlName="fechaNacimiento">
                        <mat-error *ngIf="datosBasicos.controls.fechaNacimiento.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                        <mat-error *ngIf="datosBasicos.controls.fechaNacimiento.errors?.dateError">
                            La fecha no puede ser mayor al día de hoy.
                        </mat-error>
                        <mat-error *ngIf="datosBasicos.controls.fechaNacimiento.errors?.dateMayor">
                            La fecha tiene que ser 18 años menor al día de hoy.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Asesor</mat-label>
                        <mat-select formControlName="codigoAsesor">
                            <mat-option *ngFor="let asesor of dataInicial?.analistas" [value]="asesor.idusuario">
                                {{asesor.nombre}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="bg-white rounded flex justify-end items-center gap-4">
                        <button mat-raised-button color="primary" type="button" matStepperNext (click)="guardar()">
                            Siguiente
                            <mat-icon svgIcon="arrow_right"></mat-icon>
                        </button>
                    </div>
                </div>
            </form>

        </mat-step>
        <mat-step [stepControl]="datosLaborares">
            <form [formGroup]="datosLaborares">
                <ng-template matStepLabel>Información laboral</ng-template>
                <div class="bg-white  rounded  pt-6 grid grid-cols-1   md:grid-cols-2">
                    <div
                        class="col-lg-12 col-sm-12 cursor-pointer font-bold mb-3 bg-accent-200 rounded-2 pl-4 mt-1 text-2xl md:col-span-2">
                        Datos laborales
                    </div>

                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Ocupación</mat-label>
                        <mat-select formControlName="ocupacio">
                            <mat-option *ngFor="let ocupacion of dataInicial?.ocupaciones" [value]="ocupacion.codigo">
                                {{ocupacion.nombre}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="datosLaborares.controls.ocupacio.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Tipo de pensión</mat-label>
                        <mat-select formControlName="pension">
                            <mat-option *ngFor="let tipoPension of dataInicial?.tiposPension"
                                [value]="tipoPension.codigo">
                                {{tipoPension.nombre}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="datosLaborares.controls.pagaduria.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>¿ En cúal empresa trabajas?</mat-label>
                        <mat-select formControlName="pagaduria">
                            <mat-option *ngFor="let pagaduria of dataInicial?.pagadurias" [value]="pagaduria.codigo">
                                {{pagaduria.nombre}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="datosLaborares.controls.pagaduria.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Otra, Indique ¿cual?</mat-label>
                        <input matInput type="text" autocomplete="off" formControlName="otraPagaduria">
                        <mat-error *ngIf="datosLaborares.controls.otraPagaduria.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>¿Qué contrato tienes?</mat-label>
                        <mat-select formControlName="tipoContrato">
                            <mat-option *ngFor="let tipoContrato of dataInicial?.tiposContratos
                            " [value]="tipoContrato.codigo" value="VEB">
                                {{tipoContrato.nombre}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="datosLaborares.controls.tipoContrato.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense ">
                        <mat-label>Fecha de Vinculación</mat-label>
                        <input style="max-height: 18px !important;" matInput type="date" autocomplete="off"
                            formControlName="fechaVinculacion">
                        <mat-error *ngIf="datosLaborares.controls.fechaVinculacion.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Cargo</mat-label>
                        <mat-select formControlName="cargo">
                            <mat-option *ngFor="let tipoContrato of dataInicial?.tiposContratos"
                                [value]="tipoContrato.codigo">
                                {{tipoContrato.nombre}}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="datosLaborares.controls.cargo.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Salario básico o pensión del volante($)</mat-label>
                        <span matPrefix>$</span>
                        <input matInput type="text" [mask]="'separator.0'" [thousandSeparator]="'.'" autocomplete="off"
                            formControlName="salarioBasico">
                        <mat-error *ngIf="datosLaborares.controls.salarioBasico.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Otros ingresos del volante (AA)</mat-label>
                        <span matPrefix>$</span>
                        <input matInput type="text"
                            matTooltip="Ingresar la suma total de los ingresos por concepto de asignación adicional, visible en el volante de nómina"
                            [mask]="'separator.0'" [thousandSeparator]="'.'" autocomplete="off"
                            formControlName="otrosIngreso">
                        <mat-error *ngIf="datosLaborares.controls.otrosIngreso.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-full px-3 fuse-mat-dense">
                        <mat-label>Descuento en volante de nómina ($)</mat-label>
                        <span matPrefix>$</span>
                        <input matInput type="text"
                            matTooltip="El valor a ingresar debe ser diferente a los descuento de ley (seguridad social)."
                            [mask]="'separator.0'" [thousandSeparator]="'.'" autocomplete="off"
                            formControlName="descuentoNomina">
                        <mat-error *ngIf="datosLaborares.controls.descuentoNomina.errors?.required">
                            Este campo es requerido.
                        </mat-error>
                    </mat-form-field>
                </div>
            </form>

            <form [formGroup]="validationOTPForm">

                <div class="w-full flex flex-col">

                    <div class="rounded-2 w-full h-8 flex bg-accent-200 mb-4">
                        <p class="text-2xl font-bold w-full mb-4 pl-4">Código OTP</p>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 px-2 mt-2 m-0 sm:m-10">

                        <div class="flex justify-center -mt-18 sm:mt-0 min-w-full bg-contain bg-center bg-no-repeat h-90"
                            style="background-image: url('../../../../../../../assets/images/logo/otp.png');">
                        </div>

                        <div class="flex w-full -mt-20 sm:mt-0 sm:w-auto h-auto p-4 items-center justify-center">

                            <div class="flex flex-wrap gap-8">

                                <div *ngIf="contador !== 180 && !otpValidado"
                                class="w-full px-3 fuse-mat-dense flex justify-center items-center min-h-2 mt-3">
                                <mat-progress-bar style="width: 100%;" mode="determinate"
                                    [value]="(contador / 180) * 100"></mat-progress-bar>
                            </div>
                                <div class="w-full h-20 flex flex-row items-center justify-center mt-6">

                                    <button  [disabled]="this.validationOTPForm.invalid || contador !== 180 " mat-raised-button (click)="solicitarCodigo()" class="w-full sm:w-auto rounded-sm" color="primary" mat-stroked-button>
                                        {{changeTextOTP ? 'Reenviar código OTP' : 'Solicitar código OTP'}}
                                    </button>
                                </div>

                                <div class="w-full grid grid-cols-1 gap-4">

                                    <div class="flex flex-row justify-between w-full gap-2">
                                        <div
                                            class="w-10 h-10 sm:w-15 sm:h-15 flex-auto lg:flex-0 flex flex-row border-blue-400 border rounded-md">
                                            <input #input1 (change)="updateOTPInput()" type="text" class="w-full h-full md:pl-6 pl-2.5" maxlength="1">
                                        </div>

                                        <div
                                            class="w-10 h-10 sm:w-15 sm:h-15 flex-auto lg:flex-0 flex flex-row border-blue-400 border rounded-md">
                                            <input #input2 (change)="updateOTPInput()" type="text" class="w-full h-full md:pl-6 pl-2.5" maxlength="1">
                                        </div>

                                        <div
                                            class="w-10 h-10 sm:w-15 sm:h-15 flex-auto lg:flex-0 flex flex-row border-blue-400 border rounded-md">
                                            <input #input3 (change)="updateOTPInput()" type="text" class="w-full h-full md:pl-6 pl-2.5" maxlength="1">
                                        </div>

                                        <div
                                            class="w-10 h-10 sm:w-15 sm:h-15 flex-auto lg:flex-0 flex flex-row border-blue-400 border rounded-md">
                                            <input #input4 (change)="updateOTPInput()" type="text" class="w-full h-full md:pl-6 pl-2.5" maxlength="1">
                                        </div>

                                        <div
                                            class="w-10 h-10 sm:w-15 sm:h-15 flex-auto lg:flex-0 flex flex-row border-blue-400 border rounded-md">
                                            <input #input5 (change)="updateOTPInput()" type="text" class="w-full h-full md:pl-6 pl-2.5" maxlength="1">
                                        </div>

                                        <div
                                            class="w-10 h-10 sm:w-15 sm:h-15 flex-auto lg:flex-0 flex flex-row border-blue-400 border rounded-md">
                                            <input #input6 (keyup)="updateOTPInput()" type="text" class="w-full h-full md:pl-6 pl-2.5" maxlength="1">
                                        </div>

                                    </div>

                                </div>

                                <div class="w-full h-20 flex flex-row items-center justify-center">

                                    <button mat-raised-button class="w-full sm:w-auto rounded-sm" color="primary" mat-stroked-button>
                                        Verificar OTP
                                    </button>
                                </div>

                            </div>

                        </div>

                    </div>

                </div>



            </form>
            <div class="bg-white rounded  pt-6 pb-8 mb-18 sm:flex sm:justify-end gap-4">
                <button mat-raised-button color="primary" type="button" [disabled]="this.validationOTPForm.invalid"
                    (click)="guardar()">
                    Guardar
                </button>
            </div>
        </mat-step>
    </mat-stepper>

</div>
