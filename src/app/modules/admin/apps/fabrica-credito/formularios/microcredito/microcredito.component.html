<div class="bg-white h-full h-screen pb-11 overflow-auto px-3 rounded-lg shadow w-full y-100" cdkScrollable>
    <div class="flex flex-wrap w-full mx-auto p-6 md:p-8 bg-white z-10">

        <!-- Title and action buttons -->
        <div class="flex items-center justify-between w-full">
            <div class="flex items-center ">
                <div class="flex-0 w-16 h-16  overflow-hidden">
                    <img src="assets/images/agendas/formulario-de-llenado.png" class="w-full h-full object-cover">
                </div>
                <div class="flex-1 mx-3">
                    <div class="text-3xl font-bold tracking-tight leading-8 text-gray-700">Formulario de microcrédito
                    </div>
                    <div class="flex items-center">
                        <mat-icon svgIcon="heroicons_solid:bell" class="text-gray-400"></mat-icon>
                        <div class="font-medium tracking-tight text-secondary">
                            Complete el formulario
                        </div>
                    </div>


                </div>

            </div>
            <app-fabrica-opciones *ngIf="!numeroSolicitud"></app-fabrica-opciones>
        </div>
    </div>

    <form [formGroup]="form">
        <div class="bg-white  rounded px-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4">
            <div
                class="col-lg-12 col-sm-12 cursor-pointer font-bold mb-3 bg-accent-200 rounded-2 pl-4 mt-1 pl-0 text-2xl md:col-span-4">
                <!-- <mat-icon svgIcon="heroicons_solid:bell" class="text-gray-400"></mat-icon> -->
                Datos básicos
            </div>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Tipo de identificación</mat-label>
                <mat-select formControlName="tipoDocumento" (selectionChange)="solicitudesFormularioSimulaciones()">
                    <mat-option *ngFor="let tiposDocumentos of dataInicial?.tiposDocumentos"
                        [value]="tiposDocumentos.codigo"  [disabled]="tiposDocumentos.codigo === 'CE'">{{tiposDocumentos.valor}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>No. de identificación</mat-label>
                <input matInput type="text" autocomplete="off" formControlName="identificacion"
                    (change)="solicitudesFormularioSimulaciones()">
                <mat-error *ngIf="form.controls.identificacion.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.identificacion.errors?.pattern">
                    Cantidad de números de 5-10.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Primer nombre</mat-label>
                <input matInput type="text" autocomplete="off" formControlName="primerNombre">
                <mat-error *ngIf="form.controls.primerNombre.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.primerNombre.errors?.pattern">
                    No se aceptan caracteres especiales.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Primer apellido</mat-label>
                <input matInput type="text" autocomplete="off" formControlName="primerApellido">
                <mat-error *ngIf="form.controls.primerApellido.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.primerApellido.errors?.pattern">
                    No se aceptan caracteres especiales.
                </mat-error>
            </mat-form-field>

            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Celular</mat-label>
                <input matInput type="text" autocomplete="off" formControlName="celular" prefix="+57 "
                    mask="(000) 000 00 00">
                <mat-error *ngIf="form.controls.celular.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.celular.errors?.pattern">
                    Debe comenzar en 3 y tener 10 digitos
                </mat-error>

            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Correo electrónico</mat-label>
                <input matInput type="email" autocomplete="off" formControlName="email">
                <mat-error *ngIf="form.controls.email.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.email.errors?.email">
                    Email invalido.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Fecha de nacimiento</mat-label>
                <input matInput type="date" autocomplete="off" formControlName="fechaNacimiento"
                    (change)="validacionCampos('Fecha de nacimiento','Este campo modifica el motor de decisión y políticas SARC', 'fechaNacimiento', 'STRING')">
                <mat-error *ngIf="form.controls.fechaNacimiento.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.fechaNacimiento.errors?.dateError">
                    La fecha no puede ser mayor al día de hoy.
                </mat-error>
                <mat-error *ngIf="form.controls.fechaNacimiento.errors?.dateMayor">
                    La fecha tiene que ser 18 años menor al día de hoy.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Nivel de estudio </mat-label>
                <mat-select formControlName="nivelEstudio">
                    <mat-option *ngFor="let nivelEstudio of dataInicial?.nivelesEstudio"
                        [value]="nivelEstudio.codigoOpcion">{{nivelEstudio.descripcionOpcion}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.nivelEstudio.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>

            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Estrato</mat-label>
                <mat-select formControlName="estrato">
                    <mat-option *ngFor="let estratosVivienda of dataInicial?.estratosVivienda"
                        [value]="estratosVivienda.codigo">{{estratosVivienda.nombre}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.estrato.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
        </div>

        <div class="bg-white  rounded px-8 pt-6 grid grid-cols-1   md:grid-cols-2">

            <div
                class="col-lg-12 col-sm-12 cursor-pointer font-bold mb-3 bg-accent-200 rounded-2 pl-4 mt-1 text-2xl md:col-span-2">
                Datos
                del negocio
            </div>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿ Comercializas productos o servicios?</mat-label>
                <mat-select formControlName="tipoActividad">
                    <mat-option *ngFor="let actividadesMicro of dataInicial?.actividadesMicro"
                        [value]="actividadesMicro.codigo">{{actividadesMicro.valor}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.tipoActividad.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿ Tu negocio está registrado en cámara de comercio?</mat-label>
                <mat-select formControlName="camaraComercio"
                    (selectionChange)="validacionCampos('Tu negocio está registrado en cámara de comercio','Este campo modifica el motor de decisión y políticas SARC', 'camaraComercio', 'STRING')">
                    <mat-option *ngFor="let camaraComercio of dataInicial?.camaraComercio"
                        [value]="camaraComercio.codigo">{{camaraComercio.valor}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.camaraComercio.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿ En qué tipo de local queda tu negocio?</mat-label>
                <mat-select formControlName="tipoLocal">
                    <mat-option *ngFor="let tiposLocales of dataInicial?.tiposLocales"
                        [value]="tiposLocales.codigo">{{tiposLocales.valor}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.tipoLocal.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
            <mat-form-field *ngIf="form.controls.tipoLocal.value !== '6'" class="w-full px-3 fuse-mat-dense" hideRequiredMarker>
                <mat-label>Antiguedad del local en meses </mat-label>
                <input matInput type="number" autocomplete="off" formControlName="antiguedadLocal" >
                <mat-error *ngIf="form.controls.antiguedadLocal.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.antiguedadLocal.errors?.min">
                    No se permiten números negativos
                </mat-error>
            </mat-form-field>

            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Actividad económica </mat-label>
                <mat-select formControlName="actividadEconomica"
                    (selectionChange)="validacionCampos('Actividad económica','Este campo modifica el motor de decisión y políticas SARC', 'actividadEconomica', 'STRING')">
                    <mat-option *ngFor="let ActividadEconomica of listadoActividadEconomica"
                        [value]="ActividadEconomica.codigo">{{ActividadEconomica.valor}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.actividadEconomica.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Actividad específica</mat-label>
                <input matInput type="text" autocomplete="off" formControlName="actividadEspecifica">
                <mat-error *ngIf="form.controls.actividadEspecifica.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿Cuánto tiempo en (meses) llevas ejerciendo esta actividad? </mat-label>
                <input matInput type="number" autocomplete="off" formControlName="antiguedadActividad">
                <mat-error *ngIf="form.controls.antiguedadActividad.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.antiguedadActividad.errors?.min">
                    No se permiten números negativos
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿Cuánto tiempo en (meses) tiene tu negocio?</mat-label>
                <input matInput type="number" autocomplete="off" formControlName="antiguedadNegocio"
                    (change)="validacionCampos('Cuánto tiempo en (meses) tiene tu negocio','Este campo modifica el motor de decisión y políticas SARC', 'antiguedadNegocio', 'INTEGER')">
                <mat-error *ngIf="form.controls.antiguedadNegocio.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.antiguedadNegocio.errors?.min">
                    No se permiten números negativos
                </mat-error>
            </mat-form-field>

            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿En qué departamento de colombia queda tu negocio?</mat-label>
                <mat-select formControlName="departamentoNegocio"
                    (selectionChange)="validacionCampos('En qué departamento de colombia queda tu negocio','Este campo modifica el motor de decisión y políticas SARC', 'departamentoNegocio', 'STRING')"
                    (selectionChange)="listarCiudades()">
                    <mat-option *ngFor="let departamentosMicro of dataInicial?.departamentosMicro"
                        [value]="departamentosMicro.codigo">{{departamentosMicro.valor}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.departamentoNegocio.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿En qué municipio o ciudad está tu negocio? </mat-label>
                <mat-select formControlName="ciudadNegocio"
                    (selectionChange)="validacionCampos('En qué municipio o ciudad está tu negocio','Este campo modifica el motor de decisión y políticas SARC', 'ciudadNegocio', 'STRING')"
                    (selectionChange)="listarBarrios()">
                    <mat-option *ngFor="let ciudades of listadoCiudades" [value]="ciudades.codigo">{{ciudades.valor}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.ciudadNegocio.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿En qué barrio queda tu negocio?</mat-label>
                <mat-select (selectionChange)="getAsesor()" formControlName="barrioNegocio">
                    <mat-option *ngFor="let barrios of listadoBarrios" [value]="barrios.codigo">{{barrios.upper}}
                    </mat-option>
                </mat-select>
                <mat-error *ngIf="form.controls.barrioNegocio.errors?.required">
                    Este campo es requerido.
                </mat-error>
            </mat-form-field>
        </div>
        <div class="bg-white shadow-md rounded px-8 pt-6 grid grid-cols-1   md:grid-cols-2">

            <div
                class="col-lg-12 col-sm-12 cursor-pointer font-bold mb-3 bg-accent-200 rounded-2 pl-4 mt-1 text-2xl md:col-span-2">
                Datos
                del crédito
            </div>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>¿Cuánto dinero necesitas para tu negocio?</mat-label>
                <input matInput type="text" autocomplete="off" formControlName="valorCredito" (change)="validacionCampos('Cuánto dinero necesitas para tu negocio','Este campo modifica el motor de decisión y políticas SARC', 'valorCredito', 'STRING');
                    getPlazosCredito(this.form.controls.valorCredito.value)
                    " mask="separator.0" thousandSeparator=".">
                <mat-error *ngIf="form.controls.valorCredito.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="form.controls.valorCredito.errors?.min">
                    Monto mínimo de {{salarioMinimo}}
                </mat-error>
                <mat-error *ngIf="form.controls.valorCredito.errors?.max">
                    Monto máximo de 100.000.000
                </mat-error>
            </mat-form-field>
            <mat-form-field *ngIf="this.plazosCredito$ | async as plazos" class="w-full px-3 fuse-mat-dense">
                <mat-label>¿En cuántos meses vas a pagar tu crédito?</mat-label>
                <input matInput type="number" autocomplete="off" [min]="plazos.data[0].plazoMinimo"
                    [max]="plazos.data[0].plazoMaximo" formControlName="plazoCredito"
                    (change)="validacionCampos('En cuántos meses vas a pagar tu crédito','Este campo modifica el motor de decisión y políticas SARC', 'plazoCredito', 'INTEGER')">
                <mat-error *ngIf="form.controls.plazoCredito.errors?.required">
                    Este campo es requerido.
                </mat-error>
                <mat-error *ngIf="
                form.controls.plazoCredito.errors
                    ?.min
            ">
                    No puede ser menor a {{plazos.data[0].plazoMinimo}}
                </mat-error>
                <mat-error *ngIf="
                form.controls.plazoCredito.errors
                    ?.max
            ">
                    No puede ser mayor a {{plazos.data[0].plazoMaximo}}
                </mat-error>
            </mat-form-field>
            <mat-form-field class="w-full px-3 fuse-mat-dense">
                <mat-label>Asesor de microcrédito</mat-label>
                <input matInput type="text" autocomplete="off" formControlName="asesorMicro" readonly="true">

            </mat-form-field>
            <div class="grid grid-cols-1 mb-2">
                <mat-checkbox class="ml-1 mb-0" formControlName="autorizacionCentrales"> <a
                        href="./assets/documentos/autorizacion.pdf" class="text-md no-underline " target="_blank">Autorización de consulta en centrales</a> </mat-checkbox>
                <mat-checkbox class="ml-1 mb-0" formControlName="clausulaVeracidad"> <a
                        href="./assets/documentos/clausula_veracidad.pdf" class="text-md no-underline" target="_blank"> Cláusula de Veracidad </a></mat-checkbox>
                        <mat-checkbox class="ml-1 mb-0" formControlName="terminosCondiciones"> <a
                            href="./assets/documentos/terminos_condiciones.pdf" class="text-md no-underline" target="_blank"> Términos y condiciones </a></mat-checkbox>
            </div>
        </div>

        

        <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 sm:flex sm:justify-end">
            <button mat-raised-button color="primary" type="button" (click)="save()">
                Guardar
            </button>
        </div>
    </form>
</div>